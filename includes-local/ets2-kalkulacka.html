<div id="ets2-kalkulacka">
    <h3>Jak se projeví různá cena povolenky na ceně fosilních paliv?</h3>
    <div class="allowancePrice">
        <span id="allowance-input-number">30</span> € za povolenku
        <!--<input type="number" id="allowance-input-number" name="povolenka" value="30" min="0" max="70"> € za povolenku-->
        <span class="note">(<span id="allowance-price-czk">750</span> Kč)</span>
    </div>
    
    <input class="slider" type="range" min="0" max="70" value="30"  id="allowance-input-range">
    <div class="greyzoneNote">Opatření je nastaveno tak, aby cena povolenky <b>nebyla dlouhodobě vyšší než 45 eur</b></div>
    <img src="/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-greyzone-mob.svg" class="slider-greyzone" alt="Popis slideru TODO">
    <img src="/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-scale-des.svg" class="slider-scale" alt="Popis slideru TODO">


    <div class="fuel">
        <div class="fuelName"><i class="fa-solid fa-gas-pump benzin"></i>&ensp;Benzín</div>
        <div><span class="fuelPrice" carbonContent="2.4"></span> Kč za litr</div>
        <div class="fuelIncreaseContext">+<span class="pricePercentage">4,5</span> % při ceně <span class="currentPrice">40</span> Kč/l</div>
    </div>
    <div class="fuel">
        <div class="fuelName"><i class="fa-solid fa-gas-pump nafta"></i>&ensp;Nafta</div>
        <div><span class="fuelPrice" carbonContent="2.6"></span> Kč za litr</div>
        <div class="fuelIncreaseContext">+<span class="pricePercentage">4,9</span> % při ceně <span class="currentPrice">40</span> Kč/l</div>
    </div>
    <div class="fuel">
        <div class="fuelName"><i class="fa-solid fa-fire-flame-simple"></i>&ensp;Zemní plyn</div>
        <div><span class="fuelPrice" carbonContent="1.9"></span> Kč za m<sup>3</sup></div>
        <div class="fuelIncreaseContext">+<span class="pricePercentage">9,5</span> % při ceně <span class="currentPrice">15</span> Kč/m<sup>3</sup></div>
    </div>
    <div class="fuel">
        <div class="fuelName"><img class="pictogram" alt="Piktogram uhlí" src="/assets-local/figures/emisni-povolenky-ets-2/coal-icon.svg">&ensp;Uhlí</div>
        <div><span class="fuelPrice" carbonContent="209.0"></span> Kč za 100 kg</div>
        <div class="fuelIncreaseContext">+<span class="pricePercentage">32</span> % při ceně <span class="currentPrice">680</span> Kč/100 kg</div>
    </div>  
    <div id="kurz" class="note">kurz: 1 € = <span id="exchangeRate">25</span> Kč</div>

    <script>

        
        const allowanceInputNumber = document.querySelector('#allowance-input-number');
        const allowanceInputRange = document.querySelector('#allowance-input-range');
        
        //allowanceInputNumber.addEventListener('input', function (e) { allowanceInputRange.value = e.target.value; updatePrices()});
        //allowanceInputRange.addEventListener('input', function (e) { allowanceInputNumber.value = e.target.value; updatePrices()});

        allowanceInputRange.addEventListener('input', function (e) { allowanceInputNumber.innerHTML = e.target.value; updatePrices()});

        const exchangeRate = parseFloat(document.querySelector('#exchangeRate').innerHTML)

        // List of fuels displayed in calculator 
        const fuels = document.querySelectorAll('.fuel');

        function updatePrices(){

            const allowancePrice = parseFloat(allowanceInputRange.value);

            // Updating allowance price in CZK
            const allowancePriceCZK = (Math.round(allowancePrice*exchangeRate*10) / 10).toString().replace('.', ',');
            document.querySelector('#allowance-price-czk').innerHTML = allowancePriceCZK;

            for (let fuel of fuels){
                const priceField = fuel.querySelector('.fuelPrice');
                const percentageField = fuel.querySelector('.pricePercentage');

                const currentPrice = fuel.querySelector('.currentPrice').innerHTML;

                // Updating price increase
                const price = allowancePrice/1000*parseFloat(fuel.querySelector('.fuelPrice').getAttribute('carbonContent'))*exchangeRate;
                const roundedPrice = (Math.round(price*10) / 10).toFixed(1);
                const resultString = '+'+roundedPrice.toString().replace('.', ',');
                priceField.innerHTML = resultString;

                // Updating percentage increase
                const pricePercentage = (Math.round(price/currentPrice*100*10) / 10).toFixed(1).toString().replace('.', ',');
                percentageField.innerHTML = pricePercentage;
            }
        }

        updatePrices();
    
    </script>
</div>

<style>
    #ets2-kalkulacka{
        border-radius: 0.5rem;
        background-color: #f7f7f7;
        padding: 1.5rem;
        display: grid;
        grid-template-columns: 3fr 4fr;

    }

    #ets2-kalkulacka h3{
        grid-column: 1/3;
        margin-bottom: 1rem;
    }

    #allowance-input-range{
        width: 100%;
        height: 5px;
        margin-top: 1rem; 
        margin-bottom: 1rem;  
        z-index: 99;
    }

    .slider{
        grid-row: 3/4;
        grid-column: 1/3;
        align-self: center;
    }

    .slider-greyzone, .slider-scale{
        width: 100%;
        grid-column: 1/3;
    }

    .slider-greyzone{
        grid-row: 3/4;
        align-self: center;
        content:url("/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-greyzone-mob.svg");
    }

    .slider-scale{
        grid-row: 4/5;
        content:url("/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-scale-mob.svg");
    }

    #allowance-input-number{
        font-weight: 600;
        background: none;
        border: none;
        text-align: left;
    }

    .allowancePrice{
        font-weight: 600;
        grid-column: 1/3;
        grid-row: 2/3;
        align-self: end;
        margin-bottom: 1rem;
    }

    .greyzoneNote{
        grid-column: 1/4;
        grid-row: 5/6;
        font-size: 1rem;
        line-height: 1.2;
        align-self: end;
        color: gray;
    }

    .fuel{
        grid-column: 1/3;
        display: grid;
        grid-template-columns: 3fr 4fr 5fr;
        align-items: baseline;
    }

    .fuelName{
        grid-column: 1/4;
        padding-top: 1rem;
    }

    /* … */
    div:has(> span.fuelPrice){
        grid-column: 1/4;
    }

    .fuelName, .fuelIncreaseContext{
        font-weight: 600;
    }

    .fuelIncreaseContext {
        grid-column: 1/4;
    }

    @media (min-width: 768px) {
        #ets2-kalkulacka h3{
            margin-bottom: 2rem;
        }

        .allowancePrice{
            margin-bottom: 0rem;
        }

        .fuelName{
            grid-column: 1/2;
        }

        div:has(> span.fuelPrice){
            grid-column: 2/3;
        }

        .fuelIncreaseContext{
            grid-column: 3/4;
        }

        .fuelName, .fuelIncreaseContext{
            padding-top: 0rem;
            padding-bottom: 0.5rem;
        }
        .slider-greyzone{
            content:url("/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-greyzone-des.svg");
        }

        .slider-scale{
            margin-bottom: 1.5rem;
            content:url("/assets-local/figures/emisni-povolenky-ets-2/cs-kalkulacka-scale-des.svg");
        }

        .greyzoneNote{
            grid-column: 2/3;
            grid-row: 2/3;
        }
    }

    .fuelPrice, #allowance-input-number{
        color: #3B3B93;
        font-weight: 600;
        font-size: 1.3rem;
    }

    #ets2-kalkulacka .note{
        font-size: 1rem;
        color: gray;
    }

    #kurz{
        width: 100%;
        text-align: right;
        grid-column: 1/3;
        margin-top: 2rem;
    }

    #ets2-kalkulacka .pictogram{
        height: 1rem;
        margin-bottom: 0.2rem;
    }

    .fuelIncreaseContext{
        color: gray;
    }

    input[type='range']{
        accent-color: #3B3B93;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    input[type=number]{
        -moz-appearance: textfield;
    }

</style>